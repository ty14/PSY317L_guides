# Introduction to Data Carpentry


Data carpentry gives us the tools to work with large data sets. During this chapter you will learn basic concepts, skills to help you work with functions to help tidy and manage your data. 


## Importing Data

There are different options for importing data. It's possible to import data of all different formats into RStudio. We will primarily use spreadsheet type files that have been saved with the ".csv" suffix.  These are called 'comma separated files'.  

**Option 1. Import Tab** You can click on the "Import Dataset" tab in the top right of RStudio - it's located just above your global environment. 

Depending on your RStudio version, you will be asked to select from a dropdown menu. When importing `.csv` files, you want to select `From CSV...` if your menu looks like this:


![](img/import_dataset.png){width=800px}


If your menu looks like the underneath, then you'll want to select `From Text (readr)`:

![](img/import2.png){width=500px}


<br>

**Option 2. Writing code.**  This is the option that we will use in our scripts for this course. You may notice that all the datasets that we wish to use are in a folder called "data".  To read in any of these datasets, what we need to do is use the `read_csv()` function.  This comes from a package contained with the `tidyverse` package, so we must have imported that library first.  We then tell it which dataset to find within the 'data' folder. We use the notation "data/..." to tell it to look inside the data folder.  For instance, if we wished to load in the `bmi.csv` dataset, and assign it the name `bmi`, we would do it like this - make sure to put quotes around the whole file name and location:

```{r, message=FALSE}
library(tidyverse)  #load package

bmi <- read_csv("data/bmi.csv") # bring in data

head(bmi) # first six rows

tail(bmi) # last six rows

```

If you want to see more on what the data looks like the following functions can help. 
```{r}
nrow(bmi) # how many rows in dataset

ncol(bmi) # how many columns in dataset

colnames(bmi) # column names
```

If you just want to view your entire dataset, there is a function for that. 

`View(bmi)`


You can also see the struture of your data, whether each variable is a number, character, factor, etc. This will become extremely important when trying to graph and analysis different types of data.  

```{r}
str(bmi)
```
Here you can see that all variables are numeric, except for education with is a character. 

If you need to change the struture of a variable say to a factor to group data in a certain way you would do the following: 

```{r}
bmi$smoke <- as.factor(bmi$smoke)
```

The `$` basically allows you to call certain columns in a datframe. The code `bmi$smoke` is allowing us to only change that column, or variable to a factor without changing anything else in the dataframe. 

You can also change variables to characters with `as.character()` and to numbers with `as.number()`. 



## Introduction to Dataframes

What is a dataframe and how do we get one from our data. 

A dataframe, in R is like a table that includes your data, each column contains values or characters for one variable. 

In R dataframes need to contain the following:

1. Columns should all be the same length, with unique column names. These column names should not start with number and hold no spaces. 

2. The data stored in datagframes can hold many different structures such as numeric, factor or character type. 


Let's divide into all the features of a dataframe.

First import data.

```{r, warning=F, message=FALSE}

df <- read_csv("data/cheese.csv")
```

Explore the Data

 1. look at top rows
 
```{r}
head(df)

head(df, 4)

head(df, 8)

```

 2. look at bottom rows
```{r}
tail(df)

tail(df, 10)
```

3. dataframe Dimensions

```{r}
nrow(df)  #73

ncol(df)  #9

dim(df) #73 9

length(df) #9
```

4. Column names in dataframe

```{r}
head(df)

colnames(df)

```

Changing column names 
```{r}
colnames(df)[6] <- "carbo"

colnames(df)
```

5. Indexing dataframes.
 The `$` indicates which column to call. 

```{r}
df$chol

df$type

df$kcal
```

What if you just want the first 10 rows of kcal:
```{r}
df$kcal[1:10]
```

Call just certain rows and columns. **Important:** rows before comma, columns after comma.

Just get the 7th row:
```{r}
df[7,]
```

Get the 10th to 14th rows:
```{r}
df[10:14,]
```

Get the first and second columns:
```{r}
df[,1:2]
```

Get 3rd, 5th, and 9th columns: 
```{r}
df[,c(3,5,9)]
```

Get the 20th to 22nd row, and the 1st, 8th and 9th column:

```{r}
df[20:22,c(1,8,9)]
```

6. Creating new column
```{r}
head(df)

df$food_type <- "cheese"

head(df)
```
 
7. Deleting a new column

```{r}
df$food_type <- NULL

head(df)
```


    
    
    
<br><br><br><br>



## tidyverse

The package `tidyverse` is what we will be using for most of our data carpentry. `tidyverse` is a larger package which includes several packages useful for dealing with data such as `tidyr`, `dplyr`, `ggplot2`, and more. 

All of these packages work together to manipulate, reshape, and visual data. 

Functions and syntax to know before beginning the chapter: 

`filter()`    - subsetting data

`select()`    - selecting columns

`arrange()`   - sorting a column

`mutate()`    - adding a new column


`%>%`  means "and next do this"  

`==`  means "is equal to"

`!=` means "is not equal to"

`|`  means "or"


Before using `tidyverse` you will need to install and load the package. 

You will only need to install a package once, but will have to load a library on every script you plan to use it. 

```{r, eval=FALSE}
install.package(tidyverse) #install

```

From the `tidyverse` package `readr` we can read in our data.

```{r, message = FALSE}
library(tidyverse) #load
bw <- read_csv("data/bloodwork.csv")

```

bw is the name of our new dataframe, which will include all data from the bloodwork.csv file. 

Before we can work with our data we need to what we have to work with using the functions `head()` and `tail()` allows you to see the first and last 6 rows, respectfully. 

```{r}
head(bw) # first 6 lines 
```


```{r}
tail(bw) #last 6 lines
```

should we explain the dataset?? idk


`table()` summarizes categorical variables.

table(bw$sex)
table(bw$children)
table(bw$sex, bw$children)


## filter()
Use %>% and 'filter' to only keep rows where the hrate, heart rate, is over 60. > means greater than.


```{r} 
bw %>% 
  filter(hrate > 60)
```


Use %>% and 'filter' to only keep rows where the sex is equal to female.
```{r} 
bw %>% 
  filter(sex == "female")
```
You can filter to only include, certain rows, such as state as "NJ" or "NY" in the bloodwork dataset.
```{r}
bw %>% 
  filter(state == "NJ"  |  state == "NY")
```


You can filter several variables at one time.

```{r}
bw %>% 
  filter( sex == "female", hrate > 60, children != "0" )

```

You can create new datasets from filtered data by creating a new object

```{r} 
female <- bw %>% 
  filter( sex == "female", hrate > 60, children != "0" )
```

## select()
Use %>% then `select` to just select the rows you want.

```{r}
bw %>% 
  select(ids, sex, smoker,hrate,children)
```


Or if you just want to get rid of one column you can just use %>% then `select(-var)`

```{r}
bw %>% select(-children, -bpsyst)
```

You can rename columns as you go

```{r}
bw %>% select(subject = ids, gender = sex, smoker,hrate,children)
```

if you want these selections to be permanent then you need to rewrite selections in new dataframe. See the difference between bw and bw1 

```{r}
bw1 <- bw %>%  
  select(subject = ids, gender = sex, smoker,hrate,children)
head(bw)
head(bw1)
```

If you just want to use the column number, you can do that too!

The code below selects for column 1-4, 9, 10, but does not save the information as a new object. 

```{r}
bw %>% select(1,2,3,4,9,10)

bw %>% select(1:4,9,10)

```

## mutate()

Create new columns using %>% then `mutate`

``` {r}
bw %>% 
  mutate(totalimmune = immuncount + immuncount2)
```

Saving new column in a new data frame. Now, bw2 will have 12 columns, instead of 11.  
```{r}
bw2 <- bw %>% 
  mutate(totalimmune = immuncount + immuncount2)
```

You can also create new columns without `tidyverse`

```{r}

bw$totalimmune <- bw$immuncount + bw$immuncount2
```
Now bw and bw2 are the same. 

## arrange()

Lets try another example!

```{r}
pga <- read_csv("data/pga.csv")

head(pga)
colnames(pga)
table(pga$year)
```

let's pick out name, year, total.holes, total.putts, score.avg columns and save as pga1. 
```{r}
pga %>% select(name, year, total.holes, total.putts, score.avg) 

pga1 <- pga %>% select(name, year, total.holes, total.putts, score.avg)  

```

Here we can sort a column using arrange(). There are many ways you can arrange your data. 

sorts data in ascending order
```{r}
pga1 %>% arrange(score.avg)  
```

sorts data in descending order
```{r}
pga1 %>% arrange(-score.avg)  
```

sorts data in ascending alphabetical order
```{r}
pga1 %>% arrange(name) 
```

sorts data first by year, then by score
``` {r}
pga1 %>% arrange(year, score.avg)  
```


You can use the pipe, ` %>% `, in `tidyverse` to run multiple commands at once. 

```{r}
pga %>%
  select(name, year, total.holes, total.putts, score.avg)  %>%
  mutate(putt.avg = total.putts / total.holes) %>%
  arrange(putt.avg)

```



## Wide vs Long Data

Sometimes you will need to rearrange your data for some data analysis and more commonly for data visualization. 

`tidyverse` has built in functions that can turn your dataframe from long format to wide format and vice versa. 


`pivot_longer` makes the dataframes longer by increasing the number of rows by combing the number of columns. This is called long form data, which is needed to tidy data for graphing and some analysis.


insert 3 column version.





```{r}
wheel <- read_csv("data/wheels1.csv")

head(wheel)
```
Here we can make the wheel data into long form, by combining day1, day2, day3, and day4 into 2 columns one called day and another called distance. 

```{r}
wheel_long <-wheel %>% 
  pivot_longer(
  cols = starts_with("day"),
  names_to = "day",
  values_to = "distance"
)

head(wheel_long)
```

Other ways to do this. 


`pivot_wider()` makes the dataframes longer by decreasing the number of rows by separating the number of columns. This is called wide form data, which id usefull for summarying data in tables and using some functions in R. 

Now let's make the dataframe wide again. 
```{r}
wheel_long %>% pivot_wider(
  names_from = day,
  values_from = distance
)
```



## Joins

When working with sometimes you need to join two different data sets, based on one  or more variables. 

Lets make up some data

```{r}

x <- data.frame("id" = 1:10, "age" = c(21,25,17,34,25,33,22,27,29,24))

head(x)

y <- data.frame("id" = 1:10, "height_cm" = c(156, 155, 154, 149, 153, 152, 151, 150, 147, 155), "activity_hr"= c(3,5,3,6,7,4,2,8,4,5), "work_hr" =c(40,35,38,46,50,42,40,46,41,40))

head(y)

```
`full_join()` joins 2 different dataframes based on one or more shared variable(s). The following will join based on id. 
```{r}
x %>% 
  full_join(y)
```

Save as a new data frame to use again:
```{r}
new <- x %>% 
  full_join(y)
head(new)
```


`left_join`

`right_join`